\documentclass{article}
\usepackage[linesnumbered,ruled,longend]{algorithm2e}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{multicol, relsize, geometry}
\usepackage{booktabs}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepackage{caption}
\usepackage{pgfplotstable}
\usepackage{indentfirst}
\usepackage{setspace}
\usepackage[none]{hyphenat}

\singlespacing
% Adjust spacing between paragraphs
\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}
\setlength\parindent{24pt}

% Add packages for font and encoding
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{mathptmx} % Times New Roman font

% Set font size and line spacing
\usepackage{setspace}
\fontsize{10}{12}\selectfont % 10pt font size with 12pt leading
\singlespacing % Ensure single spacing within paragraphs
% Needs to be last
\usepackage[table]{xcolor}

\DontPrintSemicolon
\SetKwFor{For}{for}{do}{end for}
\SetKwIF{If}{ElseIf}{Else}{if}{then}{else if}{else}{end if}%
% Redefine \ForEach to display a vertical line under it
\SetKwFor{ForEach}{for each}{}{end for}
\geometry{top=1cm, bottom=2cm, left=1cm, right=1cm}
\newcommand{\pluseq}{\mathrel{+}=}
\title{A heterogeneous vehicle routing problem with drones and multiple depots}
\author{Panagiotis Zachos}
\date{June 2024}

\begin{document}
	\maketitle
	
	\section{Multi-Depot mixed fleet capacitated multiple TSP}
	The problem takes as input a set of nodes, comprising of customer nodes and depot nodes. Each depot may be equipped with a heterogeneous fleet of vehicles: Trucks, Motorbikes, and Drones. Each vehicle type has a specific capacity k, representing the number of parcels it can carry. The vehicles initiate their routes from their respective depots, fully loaded with parcels, and visit customer nodes, each with a demand of one parcel. Upon completing a route, either due to no customers remaining or reaching capacity,  the vehicle returns to its depot, where it is reloaded to full capacity and can be dispatched again if there are remaining customers. The aim is to visit all customers in the minimum possible time, with \textbf{no restriction on the total number of parcels available at each depot}, thus differing from traditional MDVRP constraints.
	\par
	\begin{figure}[h]
		\caption{Solution example}
		\centering
		\includegraphics[width=\textwidth]{Solution-example}
	\end{figure}
	\twocolumn
	\subsection{Objective}
	The objective of the MD-mfcmTSP is to minimize the total makespan in which all customers have been served i.e min $M_{total}$.\;
	\newline
	\newline
	\textbf{Notation}\;
	\begin{itemize}
		\item $m$ : Number of depots
		\item $D$ : Set of depots
		\item $R_T^i$ : Truck route of depot $i\in D$ \;
		\item $R_M^i$ : Motorbike route of depot $i\in D$ \;
		\item $R_D^i$ : Drone route of depot $i\in D$ \;
		\item $M_T^i$ : Makespan of Truck route of depot $i\in D$ \;
		\item $M_M^i$ : Makespan of Motorbike route of depot $i\in D$ \;
		\item $M_D^i$ : Makespan of Drone route of depot $i\in D$ \;
		\item $M_T$ = $max(M_T^i, M_T^{i+1}, ..., M_T^m)$ : Makespan of Trucks \;
		\item $M_M$ = $max(M_M^i, M_M^{i+1}, ..., M_M^m)$ : Makespan of Motorbikes \;
		\item $M_D$ = $max(M_D^i, M_D^{i+1}, ..., M_D^m)$ : Makespan of Drones \;
		\item $M_{total}$ = $max(M_T, M_M, M_D)$ : Total makespan \;
	\end{itemize}
	\input{makespan_example.tex}
	\twocolumn
	\section{Makespan calculations}
	In the case where a depot is equipped with more than 1 vehicle of either type, the makespan calculations are explained below.
	Assume 4 routes that need to be assigned to two trucks. Each route has a time cost associated with it. The route assignment needs to be done in such a way that the trucks' makespan is minimized. We first sort the routes based on their cost in a descending order. Then, starting from the route with the maximum cost, we assign it to the truck with the currently minimum makespan. This is done iteratively until all routes have been assigned to a vehicle. 
	\input{makespan_calculations.tex}
	
	\onecolumn
	\clearpage
	\subsection{Motivation / Use case}
	By introducing this problem, we contribute to the Travelling Salesman Problem and Vehicle Routing Problem research and the field of logistics and routing by introducing a realistic and challenging problem that considers the practical limitations and requirements of different vehicle types used in last-mile delivery. The proposed algorithms have the potential to improve efficiency and reduce costs for logistics companies operating in increasingly complex delivery environments.
	\par 
	Consider a parcel delivery company operating in Greece, with depots located in two major cities: Athens and Thessaloniki. The company manages numerous last-mile delivery shops in these cities, which serve as depots in the routing problem. For instance, a customer in Thessaloniki sends a parcel to a friend in Athens by visiting a nearby shop. After the shop stops receiving parcels for the day, a truck collects the parcels and delivers them to the Thessaloniki distribution center. Parcels destined for Athens are then transported overnight to the Athens distribution center.
	Upon arrival, parcels are sorted based on their delivery areas and sent to the appropriate last-mile shops in Athens. These shops, acting as depots in our problem, dispatch vehicles (Trucks, Motorbikes, Drones) to deliver the parcels to their final destinations. The MD-mfcmTSP addresses how these vehicles can be optimally routed to minimize delivery time, while simultaneously solving the problem of parcel allocation in each last-mile shop.
	\par
	\begin{figure}[h!]
		\caption{Life of a parcel}
		\centering
		\includegraphics[width=0.40\textwidth, height=0.50\textheight]{Parcel-Life}
	\end{figure}
	\clearpage
	\twocolumn
	\section{Problem description}
	\begin{itemize}
		\item Each customer must be visited exactly once
		\item Each vehicle can serve at most as many customers per trip as its capacity
		\item Some customers may not be available for delivery via uav or larger vehicles
		\item Each depot must be equipped with at least one truck
		\item The composition of each depot's fleet is known
		\item Depots act as a start, finish and reload point for their fleet
		\item Each vehicle may perform unlimited routes (multi-trip)
	\end{itemize}
	
	\section{Pseudocode for the MD-mfcmTSP}
	At the end of Algorithm 1, a local optimization function (3) is called which in addition to moving nodes in different places in the same route, also moves nodes between routes of different depots and different vehicle types.\;
	\begin{algorithm}
		\small
		\caption{MD-mfcmTSP heuristic}
		\label{alg:MDmfcmTSP}
		\KwIn{$G_T, G_M, ..., G_D$}
		\KwOut{$M_{total}$, $Sol = \{Sol^i = \{R_T^i, R_M^i, ...,R_D^i\}, Sol^{i+1}, ..., Sol^m\}$ for each $i\in D$}
		
		Create clusters $K^i$ of customer nodes for each depot $d^i\in D$\;
		by assigning each customer to the closest possible depot\;
		\For{each $d^i\in D$}{
			
			Call $Initialization(d^i, K^i)$\;
			\While{$(M_T^i > M_M^i\parallel M_T^i > M_D^i)$ $\&\&$ $stop\neq true$}{
				$diff_M = M_T^i - M_M^i$\;
				$diff_D = M_T^i - M_D^i$\;
				\uIf{$diff_M\ge diff_D$}{
					$vt = M$\;
					$cap =$ Motorbike's capacity\;
				}\Else{
					$vt = D$\;
					$cap =$ 1\;
				}
				$M_{min} = M_T^i$\;
				$r_{best} = \emptyset$\;
				\For{$j=1$ to $|R_T^i| - cap$}{
					$successive\_nodes = \emptyset$\;
					$load = 0$\;
					\While{$load + v_j^{demand} \leq cap$ $\&\&$ $v_j\in G_{vt}$}{
						$successive\_nodes \pluseq v_j$\;
					}
					\If{$|successive\_nodes| == cap$}{
						$r_{new} = R_T^i[0] + \{successive\_nodes\} + R_T^i[0]$\;
						${R'}_{vt}^i = R_{vt}^i + r_{new}$\;
						${M'}_{vt} = {R'}_{vt}^i$ 's makespan\;
						${R'}_T^i = R_T^i - \{successive\_nodes\}$\;
						${M'}_T = {R'}_T^i$ 's makespan\;
						$M_{new} = MAX({M'}_T, {M'}_{vt})$\;
						\If{$M_{new} < M_{min}$}{
							$M_{min} = M_{new}$\;
							$r_{best} = r_{new}$\;
						}
						$r_{new} = \emptyset$\;
					}
					$j\pluseq 1$\;
				}
				\uIf{$r_{best} \neq \emptyset$}{
					$R_T^i = R_T^i - \{r_{best}^{customers}\}$\;
					$M_T = R_T^i$ 's makespan\;
					$R_{vt}^i\pluseq r_{best}$\;
					$M_{vt} = R_{vt}^i$ 's makespan\;
					Call $local\_optimization(R_T^i, n_{max})$\;
					Call $local\_optimization(R_{vt}^i, n_{max})$\;
				}\Else{ 
					$stop = true$\;
				}
			}
			$Sol^i = \{R_T^i, R_M^i, ..., R_D^i\}$\;
		}
		$M_T = MAX(M_T^i, M_T^{i+1}, ..., M_T^m)$\;
		$M_M = MAX(M_M^i, M_M^{i+1}, ..., M_M^m)$\;
		$M_D = MAX(M_D^i, M_D^{i+1}, ..., M_D^m)$\;
		$M_{total} = MAX(M_T, M_M, ..., M_D)$\;
		Call $optimization\_full(Sol, n_{max})$
	\end{algorithm}
	
	\begin{algorithm}
		\small
		\caption{Initialization($d^i, K^i$)}
		\label{alg:initialization}
		\While{$\{K^i\}\cap \{G_T\}\neq \emptyset$}{
			$R_T^i\pluseq NearestNeighbour(\{K^i\}\cap \{G_T\})$\;
		}
		$M_T^i = R_T^i$ 's makespan\;
		$v_{free} = \{K^i\} - \{G_T\}$\;
		\uIf{$v_{free} = \emptyset$}{
			\Return{$R_T^i$}\;
		}\Else{
			\While{$v_{free}\neq \emptyset$}{
				\uIf{$M_T - M_M\geq M_T - M_D \parallel G_D = \emptyset$}{
					$R_M^i\pluseq NearestNeighbour(\{K^i\}\cap \{G_M\})$\;
					$v_{free} = v_{free} - \{R_M^i\}$\;
					$M_M^i = R_M^i$ 's makespan\;
				}\Else{
					$R_D^i\pluseq closest(\{K^i\}\cap \{G_D\})$\;
					$M_D^i = R_D^i$ 's makespan\;
				}
			}
		}
		\Return{$Sol^i$}\;
	\end{algorithm}
	
	\begin{algorithm}
		\small
		\caption{$optimization\_full(Sol, n_{max})$}
		Call $vt\_optimization(Sol, n_{max} = 2)$\;
		\For{each $vt$}{
			\For{each $i\in D$}{
				Call $local\_optimization(R_{vt}^i, n_{max}=2)$\;
			}
			Call $mutual\_depot\_optimization(R_{vt}, n_{max}=2)$\;
		}
		Call $vt\_optimization(Sol, n_{max} = 2)$\;
	\end{algorithm}
	
	\begin{algorithm}
		\small
		\caption{$local\_optimization(r, n_{max})$}
		\For{$n=1$ to $n_{max}$}{
			\ForEach{combination of $n$ successive nodes on the route}{
				move the node(s) to a different place on the same route\;
				evaluate the new route\;
				\uIf{this route is better than the original and all constraints are satisfied}{
					replace the original route with the new one\;
				}
				continue in point 3 unless all possible places in the route have been evaluated\;
			}
		}
		\Return{$r$}\;
	\end{algorithm}
	
	\begin{algorithm}
		\small
		\caption{$mutual\_depot\_optimization(R_{vt}, n_{max})$}
		\For{$n = 1$ to $n_{max}$}{
			\ForEach{possible pair of depots $c1$ and $c2$}{
				\ForEach{combination of $n$ successive nodes in the route of c1}{
					remove the nodes from the route of c1 and insert them into c2\;
					evaluate the newly-created routes\;
					\uIf{$MAX(|{R'}_{vt}^{c1}|, |{R'}_{vt}^{c2}|) < MAX(|{R}_{vt}^{c1}|, |{R}_{vt}^{c2}|)$ and all constraints are satisfied}{
						replace the original routes with the new ones\;
					}
					continue in point 4 unless all possible places in c2 have been evaluated\;
				}
			}
		}
		\Return{$R_{VT}$}\;
	\end{algorithm}
	
	\begin{algorithm}
		\small
		\caption{$vt\_optimization(Sol, n_{max})$}
		\For{$n = 1$ to $n_{max}$}{
			\ForEach{depot $i\in D$}{
				\ForEach{possible pair of vehicle types $t1,t2\in VT$}{
					\ForEach{combination of $n$ successive nodes in $R_{t1}^i$}{
						remove the nodes from $R_{t1}^i$ and insert them in $R_{t2}^i$\;
						\uIf{$MAX(|{R'}_{t1}^i|, |{R'}_{t2}^i|) < MAX(|{R}_{t1}^i|, |{R}_{t2}^i|)$ and all constraints are satisfied}{
							replace the original routes with the new ones\;
						}
						continue in point 5 unless all possible places in $R_{t2}^i$ have been evaluated\;
					}
				}
			}
		}
		\Return{$Sol$}\;
	\end{algorithm}
	\clearpage
	\begin{figure*}[h]
		\caption[width=\textwidth]{p11 Initialization example using k-means clustering}
		\includegraphics[width=\textwidth]{Initialization_example_p11}
		\centering
	\end{figure*}
	\begin{figure*}[h]
		\caption[width=\textwidth]{p01 initialization using k-means clustering}
		\includegraphics[width=\textwidth]{initialization_example_p01}
		\centering
	\end{figure*}
	\begin{figure*}[h]
		\caption[width=\textwidth]{p01 solution using k-means clustering}
		\includegraphics[width=\textwidth]{solution-p01}
		\centering
	\end{figure*}
	\clearpage
	\section{AACONC+}
	\input{AACO.tex}\;
	\input{createClusters.tex}\;
	\input{antSolution.tex}\;
	\input{selectVehicle.tex}\;
	\clearpage
	\onecolumn
	\section{Instances}
	\input{instances_table.tex}\;
	\clearpage
	\begin{figure}[h!]
		\centering
		\caption{Regular Layout Instance}
		\includegraphics[width=\columnwidth]{p12_aco-1}
	\end{figure}

	\onecolumn
	\section{Results}
	\subsection{New heuristic vs old heuristic}
	\textbf{mfcmTSP heuristic (original) : } Finds and swaps the minimum cost route in each iteration \\ \;
	\\
	\par
	\textbf{MD-mfcmTSP heuristic (v1) : } Finds and swaps the route which minimizes the depot's makespan in each iteration \\ \;
	\begin{figure*}[hb!]
		\centering
		\caption{Comparison between new and original heuristic}
		\includegraphics[width=\textwidth]{heuristics_comp_gaps_lineGraph_kmeans}
	\end{figure*}
	\begin{figure*}[hb!]
		\centering
		\caption{Comparison between new and original heuristic}
		\includegraphics[width=\textwidth]{heuristics_comp_gaps_boxGraph_kmeans}
	\end{figure*}
	\begin{figure*}[hb!]
		\centering
		\caption{Comparison between new and original heuristic}
		\includegraphics[width=\textwidth]{heuristics_comp_gaps_barGraph_kmeans}
	\end{figure*}
	
	
	
	\clearpage
	\section{MD-mfcmTSP Results Analysis}
	\subsection{Local optimization impact on the heuristic}
	\subsubsection{Proximity clustering}
	\input{TABLE1.tex}\;
	\begin{figure*}[hb!]
		\centering
		\caption{Gaps to full local optimization (proximity clustering)}
		\includegraphics[width=\textwidth]{local_opt_comp_to_full_proximity}
	\end{figure*}
	\begin{figure*}[hb!]
		\centering
		\caption{Results using proximity clustering}
		\includegraphics[width=\textwidth]{Results_proximity}
	\end{figure*}

	\clearpage
	\subsubsection{k-means clustering}
	\input{TABLE3.tex}\;
	\begin{figure*}[hb!]
		\caption{Comparison to full local optimization (k-means clustering)}
		\centering
		\includegraphics[width=\textwidth]{local_opt_comp_to_full_kmeans}
	\end{figure*}
	\begin{figure*}[hb!]
		\caption{Results using k-means clustering}
		\centering
		\includegraphics[width=\textwidth]{Results_kmeans}
	\end{figure*}
	\begin{figure*}[hb!]
		\caption{Local optimization impact on computational time (k-means)}
		\centering
		\includegraphics[width=\textwidth]{optimization_times_kmeans}
	\end{figure*}

	
	
	
	\clearpage
	\subsection{AACONC+ Results and Comparison to heuristics}
	\input{TABLE2.tex}\;
	\input{AACONC_comp_table.tex}\;
	\captionsetup{justification=centering}  % Center the captions
	\begin{figure*}[h!]
		\centering
		\caption{Comparison to the best solution found by AACONC+}
		\includegraphics[width=\textwidth]{gaps_to_aco_best}
	\end{figure*}
	\begin{figure*}[h!]
		\centering
		\caption{Comparison of best results found}
		\includegraphics[width=\textwidth]{best_results_comp_barGraph}
	\end{figure*}

	\begin{figure*}[h!]
		\centering
		\caption{Comparison to the best solution found by AACONC+}
		\includegraphics[width=\textwidth]{heuristics_comp_to_best_gaps}
	\end{figure*}
	\begin{figure*}[h!]
		\centering
		\caption{Comparison to the average solution found by AACONC+}
		\includegraphics[width=\textwidth]{heuristics_comp_to_avg_gaps}
	\end{figure*}
	\begin{figure*}[h!]
		\centering
		\caption{Comparison to the worst solution found by AACONC+}
		\includegraphics[width=\textwidth]{heuristics_comp_to_worst_gaps}
	\end{figure*}
	\begin{figure*}[h!]
		\centering
		\caption{Comparison of best results found}
		\includegraphics[width=\textwidth]{best_results_all_lineGraph}
	\end{figure*}
	\begin{figure*}[h!]
		\centering
		\caption{}
		\includegraphics[width=\textwidth]{optimization_times}
	\end{figure*}
	
	
	
	\clearpage
	
	\twocolumn
	
	\section{Related Literature}
	\input{Complete_drone_literature.tex}
	At the same time, it is important that we address flight range limitations. Such limitations have important roles in much of
	the existing drone routing research. However, even he first drones developed by Amazon and JD.com ahad a flight range of 15
	to 20 miles [33, 56]. Such a range is suitable to allow out and back travel in the medium-sized cities in which the authors live,
	Braunschweig, Germany, and Iowa City, United States. In fact, it is suitable for many larger cities such as Hamburg, Munich,
	and Paris. Thus, in contrast to other drone applications, in this work, we do not consider flight range as a limiting factor (Ulmer \& Thomas (2018)).
	
	
	
\end{document}